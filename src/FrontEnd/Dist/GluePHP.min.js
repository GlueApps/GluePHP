!function(t){"use strict";function e(){this.events={}}e.prototype.addListener=function(t,e){this.events.hasOwnProperty(t)||(this.events[t]=[]),this.events[t].push(e)},e.prototype.dispatch=function(t,e){if(this.events.hasOwnProperty(t)&&Array.isArray(this.events[t]))for(var n of this.events[t]){if(e.isPropagationStopped())break;n(e)}},t.EventDispatcher=e}(window.GluePHP=window.GluePHP||{}),function(t){"use strict";function e(){this.components={}}e.prototype.getAllComponents=function(){return this.components},e.prototype._findOne=function(t,e){for(var n in t){var o=t[n];if(e==o.id)return o;if(o=this._findOne(o.components,e))return o}return null},e.prototype.getComponent=function(t){var e=t.split(" ");if(1==e.length)return this._findOne(this.components,t);var n={};for(var o of e)n[o]=null;var r=this;for(var o of e){var s=r.getComponent(o);if(!s)break;n[o]=s,r=s}return n[e.pop()]},e.prototype.addComponent=function(t){this.components[t.id]=t},e.prototype.existsComponent=function(t){return this.components.hasOwnProperty(t)},e.prototype.dropComponent=function(t){delete this.components[t]},t.ComponentContainer=e}(window.GluePHP=window.GluePHP||{}),function(t){"use strict";function e(){t.ComponentContainer.call(this),this.dispatcher=new t.EventDispatcher}(e.prototype=Object.create(t.ComponentContainer.prototype)).constructor=e,e.prototype.addListener=function(t,e){this.dispatcher.addListener(t,e)},e.prototype.dispatchInLocal=function(t,e){this.dispatcher.dispatch(t,e)},t.BaseEntity=e}(window.GluePHP=window.GluePHP||{}),function(t){"use strict";function e(e,n){t.BaseEntity.call(this),this.url=e,this.token=n,this.buffer={},this.actionHandlers={},this.processors=[],this.httpRequests=[],this.componentClasses={},this.requestMethod="POST",this.requestKey="request",this.debug=!1}(e.prototype=Object.create(t.BaseEntity.prototype)).constructor=e,e.prototype.getStatus=function(){return null},e.prototype.dispatchInRemote=function(e,n){var o=this;if(o.url){var r=this.buildRequest(e,n),s=t.Factory.App.createRequestEvent(r);this.dispatchInLocal("app.request",s);var p=new XMLHttpRequest;p.request=r,p.streaming=!1;var i=!1;p.onprogress=function(e){if(e.currentTarget){p.streaming=!0;var n,r=e.currentTarget.response;!1===i?(n=r,i=r.length):(n=r.substring(i),i=r.length);try{var s=JSON.parse(n)}catch(t){console.log(t,n)}if("code"in s){var a=t.Factory.App.createResponseEvent(s);o.dispatchInLocal("app.response",a);var c=a.response;c.request=this.request,o.processResponse(c)}else o.runAction(s)}},p.onreadystatechange=function(){if(p.readyState===XMLHttpRequest.DONE)if(o.httpRequests.splice(o.httpRequests.indexOf(p),1),200===p.status&&0==p.streaming){try{var e=JSON.parse(p.responseText)}catch(t){console.log(t,p.responseText)}var n=t.Factory.App.createResponseEvent(e);o.dispatchInLocal("app.response",n),(e=n.response).request=this.request,o.processResponse(e)}else{var s=t.Factory.App.createFailedResponseEvent(r);o.dispatchInLocal("app.failed_response",s)}},p.open(this.requestMethod,this.url,!0),p.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),p.send(this.requestKey+"="+JSON.stringify(s.request)),o.httpRequests.push(p),this.buffer={};for(var a of r.serverUpdates){var c=this.getComponent(a.componentId);if(c){var n=t.Factory.Component.createRemoteUpdateEvent(a.data);c.dispatchInLocal("remote_update",n)}}}},e.prototype.dispatch=function(t,e){this.dispatchInLocal(t,e),e.propagationStopped||this.dispatchInRemote(t,e)},e.prototype.buildRequest=function(t,e){var n=[];for(var o in this.buffer){var r={componentId:o,data:this.buffer[o]};n.push(r)}return{appToken:this.token,status:this.getStatus(),eventName:t,eventData:e,serverUpdates:n}},e.prototype.registerUpdate=function(e,n,o){var r=this.getComponent(e);r instanceof t.Component&&r.model.hasOwnProperty(n)&&(this.buffer.hasOwnProperty(e)||(this.buffer[e]={}),this.buffer[e][n]=o)},e.prototype.runAction=function(e){!0===this.debug&&console.log("Action:",e);var n=t.Factory.App.createAppActionEvent(e);return this.dispatchInLocal("app.action",n),this.actionHandlers[e.handler](e.data,this)},e.prototype.processResponse=function(e){var n=this;if(!0===this.debug&&console.log("Response:",e),200===e.code){e.request.serverUpdates.forEach(function(e){n.getComponent(e.componentId).dispatchInLocal("end_remote_update",t.Factory.Component.createEndRemoteUpdateEvent(e.data))});for(var o in e.clientUpdates){var r=e.clientUpdates[o],s=n.getComponent(r.componentId);for(var p in r.data)s[t.Helpers.getSetter(p)](r.data[p],!1)}for(var o in e.actions)n.runAction(e.actions[o])}else{var i=t.Factory.App.createResponseErrorEvent(e);n.dispatchInLocal("app.response_error",i)}},e.prototype.processComponent=function(t){for(var e of this.processors)e(t)},t.App=e}(window.GluePHP=window.GluePHP||{}),function(t){"use strict";function e(e,n,o={},r){t.BaseEntity.call(this),this.id=e,this.app=n,this.model=Object.seal(o),this.html=r}(e.prototype=Object.create(t.BaseEntity.prototype)).constructor=e,e.prototype.dispatchInApp=function(t,e){var n=this.id+"."+t;this.app.dispatch(n,e)},e.prototype.dispatch=function(t,e){this.dispatchInLocal(t,e),e.propagationStopped||this.dispatchInApp(t,e)},t.Component=e}(window.GluePHP=window.GluePHP||{}),function(t){"use strict";Event.prototype.propagationStopped=!1,Event.prototype.stopEventPropagation=function(){this.propagationStopped=!0},Event.prototype.isPropagationStopped=function(){return this.propagationStopped},t.Factory={App:{createRequestEvent:function(t){var e=new CustomEvent("app.request",{detail:t});return e.request=t,e},createAppActionEvent:function(t){var e=new CustomEvent("app.action",{detail:t});return e.action=t,e},createResponseEvent:function(t){var e=new CustomEvent("app.request",{detail:t});return e.response=t,e},createFailedResponseEvent:function(t){var e=new CustomEvent("app.failed_response",{detail:t});return e.request=t,e},createResponseErrorEvent:function(t){var e=new CustomEvent("app.response_error",{detail:t});return e.response=t,e}},Component:{createRemoteUpdateEvent:function(t){var e=new CustomEvent("remote_update",{detail:t});return e.updates=t,e},createEndRemoteUpdateEvent:function(t){var e=new CustomEvent("end_remote_update",{detail:t});return e.data=t,e}}},t.Helpers={capitalizeFirstLetter:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},getSetter:function(e){return"set"+t.Helpers.capitalizeFirstLetter(e)}}}(window.GluePHP=window.GluePHP||{});